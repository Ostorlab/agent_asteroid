"""Agent Asteroid implementation for CVE-2024-28890"""

import re

from agent import definitions
from agent import exploits_registry
from agent.exploits import webexploit

VULNERABILITY_TITLE = "Forminator plugin flaw in WordPress sites"
VULNERABILITY_REFERENCE = "CVE-2024-28890"
VULNERABILITY_DESCRIPTION = (
    "Insufficient validation of files during file upload, allowing a remote attacker "
    "to upload and execute malicious files on the site's server. Impacts Forminator 1.29.0 and earlier"
)
RISK_RATING = "CRITICAL"


@exploits_registry.register
class CVE202428890Exploit(webexploit.WebExploit):
    accept_request = definitions.Request(
        method="GET", path="/wp-content/plugins/forminator/readme.txt"
    )
    check_request = definitions.Request(
        method="GET", path="/wp-content/plugins/forminator/readme.txt"
    )
    accept_pattern = [re.compile("Forminator - Contact Form")]
    match_pattern = [re.compile(r"Version: [0-1]\.((1\d|\d)\.(\d+)|(2[0-9]\.[0-2]))")]
    metadata = definitions.VulnerabilityMetadata(
        title=VULNERABILITY_TITLE,
        description=VULNERABILITY_DESCRIPTION,
        reference=VULNERABILITY_REFERENCE,
        risk_rating=RISK_RATING,
    )
