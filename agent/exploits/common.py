"""Common utilities for the exploits."""

import ipaddress
import re
from urllib import parse as urlparse

import requests
from ostorlab.agent.kb import kb
from ostorlab.agent.mixins import agent_report_vulnerability_mixin
from requests import exceptions as requests_exceptions

from agent import definitions

MAX_REDIRECTS = 2
DEFAULT_TIMEOUT = 30


def _is_ipv6(ip: str) -> bool:
    """Check if the provided IP is an IPv6 address.
    Args:
        ip: The IP address to check.
    Returns:
        True if the IP is an IPv6 address, False otherwise.
    """
    try:
        ipaddress.IPv6Address(ip)
        return True
    except ipaddress.AddressValueError:
        return False


def prepare_host(host: str) -> str:
    """Prepare the host for the request.
    Args:
        host: The host to prepare.
    Returns:
        The prepared host.
    """
    if _is_ipv6(host) is True:
        return f"[{host}]"
    return host

