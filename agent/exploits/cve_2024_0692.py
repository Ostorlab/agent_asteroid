"""Agent Asteroid implementation for CVE-2024-0692"""

import re

from agent import definitions
from agent import exploits_registry
from agent.exploits import webexploit

VULNERABILITY_TITLE = (
    "SolarWinds Security Event Manager unauthenticated remote code execution"
)
VULNERABILITY_REFERENCE = "CVE-2024-0692"
VULNERABILITY_DESCRIPTION = (
    "The SolarWinds Security Event Manager was susceptible to Remote Code Execution Vulnerability. "
    "This vulnerability allows an unauthenticated user to abuse SolarWindsâ€™ service, resulting in "
    "remote code execution."
)
RISK_RATING = "CRITICAL"


@exploits_registry.register
class CVE20240692Exploit(webexploit.WebExploit):
    accept_request = definitions.Request(method="GET", path="/webui/")
    check_request = definitions.Request(
        method="POST", path="/services/messagebroker/streamingamf", data=b"abc"
    )
    accept_pattern = re.compile("SolarWinds Security Event Manager")
    match_pattern = re.compile("AMF version")
    metadata = definitions.VulnerabilityMetadata(
        title=VULNERABILITY_TITLE,
        description=VULNERABILITY_DESCRIPTION,
        reference=VULNERABILITY_REFERENCE,
        risk_rating=RISK_RATING,
    )
