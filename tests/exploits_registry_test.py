"""Unit tests for the exploits' registry."""
import collections

from agent import exploits_registry
from agent import exploits


def testExploitsRegistry_importingAllExploits_registerAll() -> None:
    """Ensure the exploits_registry registers all exploits."""

    exploits.import_all()

    registered_exploits = exploits_registry.ExploitsRegistry.values()

    assert len(registered_exploits) == 2


def testExploitsRegistry_allExploits_mustBeRegisteredOnce() -> None:
    """Ensure that there are no exploits registered more than once."""

    exploits.import_all()
    cnt: collections.Counter[tuple[str, ...]] = collections.Counter()

    for exploit in exploits_registry.ExploitsRegistry().values():
        cnt[exploit] += 1

    assert (
        len([v for v in cnt.values() if v > 1]) == 0
    ), f"Found {[r for r, v in cnt.items() if v > 1]}"
