"""Unit tests for the exploits' registry."""

import collections

from agent import exploits_registry
from agent import exploits


def testExploitsRegistry_importingAllExploits_registerAll() -> None:
    """Ensure the exploits_registry registers all exploits."""

    exploits.import_all()

    registered_exploits = exploits_registry.ExploitsRegistry.values()

    assert len(registered_exploits) > 0


def testExploitsRegistry_allExploits_mustBeRegisteredOnce() -> None:
    """Ensure that there are no exploits registered more than once."""

    exploits.import_all()

    cnt = collections.Counter(exploits_registry.ExploitsRegistry().values())

    assert all(
        v == 1 for v in cnt.values()
    ), f"Found {[(k, v) for k, v in cnt.items() if v > 1]}"
