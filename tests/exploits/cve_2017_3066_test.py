"""Unit tests for CVE-2016-2386"""

import requests_mock as req_mock
from agent.exploits import cve_2017_3066
from agent import definitions


def testCVE20173066_whenVulnerable_reportVulnerability(
    requests_mock: req_mock.mocker.Mocker,
) -> None:
    """Unit test for CVE-2017-3066, case when target is safe."""
    text = """<html>
            <head>
                <title>ColdFusion Administrator Login</title>
            </head>
            </html> """
    target = definitions.Target(scheme="http", host="172.19.0.2", port=8500)
    exploit_instance = cve_2017_3066.CVE20173066Exploit()

    requests_mock.get(
        "http://172.19.0.2:8500/CFIDE/administrator/index.cfm",
        text=text,
    )

    accept = exploit_instance.accept(target)

    assert accept is True
