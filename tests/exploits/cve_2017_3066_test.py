"""Unit tests for CVE-2016-2386"""

import requests_mock as req_mock
from agent.exploits import cve_2017_3066
from agent import definitions


def testCVE20173066_whenVulnerable_reportVulnerability(
    requests_mock: req_mock.mocker.Mocker,
) -> None:
    """Unit test for CVE-2017-3066, case when target is safe."""
    target = definitions.Target(scheme="http", host="127.0.0.1", port=8500)
    exploit_instance = cve_2017_3066.CVE20173066Exploit()
    requests_mock.get(
        "http://127.0.0.1/CFIDE/administrator/index.cfm:8500",
        headers={"server": "ColdFusion"},
    )

    accept = exploit_instance.accept(target)

    assert accept is True
